name: Build TypeScript Pages

on:
  push:
    branches: [main, master, develop]
    paths:
      - "asgn3/**"
      - "asgn4/**"
      - "asgn5/**"
      - ".github/workflows/build-typescript.yml"
  pull_request:
    branches: [main, master, develop]
    paths:
      - "asgn3/**"
      - "asgn4/**"
      - "asgn5/**"
      - ".github/workflows/build-typescript.yml"

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        page: [asgn3, asgn4, asgn5]

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Check if page exists
        id: check_page
        run: |
          if [ -d "${{ matrix.page }}" ] && [ -f "${{ matrix.page }}/package.json" ]; then
            echo "exists=true" >> $GITHUB_OUTPUT
            echo "Page ${{ matrix.page }} exists"
          else
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "Page ${{ matrix.page }} does not exist yet, skipping"
          fi

      - name: Setup Node.js
        if: steps.check_page.outputs.exists == 'true'
        uses: actions/setup-node@v6
        with:
          node-version: "20"
          cache: "npm"
          cache-dependency-path: "${{ matrix.page }}/package.json"

      - name: Install dependencies
        if: steps.check_page.outputs.exists == 'true'
        working-directory: ${{ matrix.page }}
        run: npm install

      - name: Build TypeScript
        if: steps.check_page.outputs.exists == 'true'
        working-directory: ${{ matrix.page }}
        run: npm run build

      - name: Check compilation output
        if: steps.check_page.outputs.exists == 'true'
        working-directory: ${{ matrix.page }}
        run: |
          if [ -d "dist" ]; then
            echo "Compilation successful! Output files:"
            ls -la dist/
          else
            echo "Warning: dist directory not found"
            exit 1
          fi

      - name: Upload compiled artifacts
        if: steps.check_page.outputs.exists == 'true'
        uses: actions/upload-artifact@v6
        with:
          name: ${{ matrix.page }}-compiled
          path: ${{ matrix.page }}/dist/
          retention-days: 30
